<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; display:flex; flex-direction:column; align-items:center; height:100vh; margin:0; }
h2 { margin: 10px 0; }
#chatbox { flex:1; width:100%; max-width:600px; border:1px solid #ccc; border-radius:10px; padding:10px; overflow-y:auto; background:white; margin:5px; }
#chatbox .message { margin:6px 0; padding:10px; border-radius:10px; max-width:75%; word-wrap:break-word; white-space:pre-wrap; }
.user { background:#d1e7dd; margin-left:auto; text-align:right; }
.bot { background:#e2e3e5; margin-right:auto; text-align:left; }
pre { background:#272822; color:#f8f8f2; padding:10px; border-radius:8px; overflow-x:auto; margin-top:5px; font-size:14px; }
.code-container { position:relative; }
.copy-btn { position:absolute; top:6px; right:6px; padding:4px 8px; font-size:12px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; }
#inputArea { display:flex; width:100%; max-width:600px; padding:8px; background:#fff; border-top:1px solid #ccc; }
#userInput { flex:1; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
#sendBtn { padding:12px 16px; margin-left:6px; border:none; border-radius:8px; background:#007bff; color:white; font-size:16px; cursor:pointer; }
#sendBtn:active { background:#0056b3; }
</style>
</head>
<body>
<h2>Gemini Chatbot</h2>
<div id="chatbox"></div>
<div id="inputArea">
  <input type="text" id="userInput" placeholder="Type your message..." />
  <button id="sendBtn">➤</button>
</div>

<script>
const API_KEY = "AIzaSyD8BpKt0msRWL7rkXk08IbH6HEk9tO46TU"; // Replace with your API key
const MODEL = "gemini-2.5-flash";

const sendBtn = document.getElementById("sendBtn");
const userInput = document.getElementById("userInput");
const chatbox = document.getElementById("chatbox");

function addMessage(message, sender) {
  const msgDiv = document.createElement("div");
  msgDiv.className = "message " + sender;
  chatbox.appendChild(msgDiv);

  // Handle code blocks
  const codeBlockRegex = /```([\s\S]*?)```/g;
  let lastIndex = 0, match;
  while((match = codeBlockRegex.exec(message)) !== null){
    if(match.index > lastIndex) msgDiv.appendChild(document.createTextNode(message.slice(lastIndex, match.index)));

    const codeContainer = document.createElement("div");
    codeContainer.className="code-container";

    const pre = document.createElement("pre");
    pre.textContent = match[1].trim();
    codeContainer.appendChild(pre);

    const copyBtn = document.createElement("button");
    copyBtn.className="copy-btn";
    copyBtn.textContent="Copy";
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(pre.textContent);
      copyBtn.textContent = "Copied!";
      setTimeout(()=>copyBtn.textContent="Copy",2000);
    };
    codeContainer.appendChild(copyBtn);

    msgDiv.appendChild(codeContainer);
    lastIndex = match.index + match[0].length;
  }

  if(lastIndex < message.length) {
    msgDiv.appendChild(document.createTextNode(message.slice(lastIndex)));
  }

  chatbox.scrollTop = chatbox.scrollHeight;
  return msgDiv;
}

async function sendMessage(){
  const message = userInput.value.trim();
  if(!message) return;
  addMessage(message, "user");
  userInput.value="";

  try{
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:[{parts:[{text:message}]}]})
    });
    const data = await response.json();
    console.log("Gemini API response:", data);

    let botReply = "";
    if(data?.candidates?.length > 0) botReply = data.candidates[0].content.parts.map(p => p.text).join("\n");
    else if(data?.error?.message) botReply = "❌ API Error: " + data.error.message;
    else botReply = "⚠️ No reply from API";

    addMessage(botReply, "bot");

  }catch(error){
    addMessage("⚠️ Network Error: " + error.message,"bot");
  }
}

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keydown", (e)=>{
  if(e.key==="Enter"){ e.preventDefault(); sendMessage(); }
});
</script>
</body>
</html>
